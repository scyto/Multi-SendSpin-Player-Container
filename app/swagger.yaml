openapi: 3.0.3
info:
  title: Multi-Room Audio Controller API
  description: |
    A comprehensive API for managing multiple audio players in a multi-room setup.
    Supports Squeezelite (LMS/SlimProto), Sendspin (Music Assistant native), and Snapcast players.

    ## Features
    - **Multi-room audio control** - Manage multiple audio players
    - **Multiple backends** - Squeezelite (LMS), Sendspin (Music Assistant), Snapcast
    - **Volume control** - Hardware ALSA mixer integration
    - **Device management** - Auto-detect and configure audio devices
    - **Real-time updates** - WebSocket support for live status updates
    - **Debug tools** - Audio device detection and troubleshooting
    - **HAOS Support** - Runs as Home Assistant OS add-on with PulseAudio

    ## Player Types
    - **Squeezelite**: Traditional LMS/SlimProto player for Logitech Media Server
    - **Sendspin**: Native Music Assistant player using synchronized audio protocol
    - **Snapcast**: Synchronized multiroom audio client for Snapserver

    ## Audio Devices
    The API automatically detects available audio devices:
    - **Hardware devices**: `hw:X,Y` format (e.g., `hw:1,0`)
    - **Virtual devices**: `null`, `pulse`, `dmix`, `default`
    - **USB devices**: Automatically detected with proper mixer controls
    - **PulseAudio**: Automatic switching when running in HAOS

    ## Volume Control
    Volume control uses ALSA mixer with automatic control detection:
    - Tries multiple mixer controls: `Master`, `PCM`, `Speaker`, `Headphone`, `Digital`
    - Returns specific control used in success messages
    - Supports 0-100% volume range

  version: 1.2.0
  contact:
    name: Multi-Room Audio Controller
    url: https://github.com/chrisuthe/Multi-SendSpin-Player-Container
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: /
    description: Current server (auto-detects protocol and host, works with HAOS ingress)
  - url: http://localhost:8095
    description: Direct access (standalone Docker, default port)

tags:
  - name: Players
    description: |
      Player management operations including create, update, delete, start, and stop.
      Supports multiple backends: Squeezelite (LMS), Sendspin (Music Assistant), and Snapcast.
  - name: Providers
    description: |
      Query available player provider backends. Each provider connects to a different
      audio server type (LMS, Music Assistant, Snapserver).
  - name: Devices
    description: |
      Audio device detection and management. Supports ALSA devices for hardware audio
      and PortAudio devices for Sendspin players.
  - name: Volume
    description: |
      Volume control operations using ALSA mixer. Works with hardware audio devices
      and automatically detects the appropriate mixer control.
  - name: State
    description: |
      State persistence operations for saving and restoring player running states.
      Only available when running the enhanced version (app_enhanced.py).
  - name: Debug
    description: |
      Debugging and troubleshooting tools for audio device detection, mixer controls,
      and system diagnostics.

paths:
  /api/players:
    get:
      tags: [Players]
      summary: List all players
      description: |
        Retrieve a list of all configured audio players with their current running status.

        Returns both the player configurations and a separate status map indicating
        which players are currently running.
      responses:
        '200':
          description: Successfully retrieved players
          content:
            application/json:
              schema:
                type: object
                properties:
                  players:
                    type: object
                    additionalProperties:
                      $ref: '#/components/schemas/Player'
                  statuses:
                    type: object
                    additionalProperties:
                      type: boolean
                      description: Running status of each player
              example:
                players:
                  Living Room:
                    name: Living Room
                    provider: squeezelite
                    device: hw:1,0
                    mac_address: dc:be:dd:e0:ce:40
                    server_ip: 192.168.1.100
                    enabled: true
                    volume: 75
                  Kitchen:
                    name: Kitchen
                    provider: sendspin
                    device: "0"
                    server_url: ws://192.168.1.100:8095
                    enabled: true
                    volume: 80
                  Bedroom:
                    name: Bedroom
                    provider: snapcast
                    device: hw:2,0
                    server_ip: 192.168.1.100
                    enabled: true
                    volume: 60
                statuses:
                  Living Room: true
                  Kitchen: true
                  Bedroom: false
    post:
      tags: [Players]
      summary: Create a new player
      description: |
        Create a new audio player with the specified configuration.

        The player type is determined by the `provider` field:
        - **squeezelite**: Connects to Logitech Media Server (requires `server_ip`)
        - **sendspin**: Connects to Music Assistant (requires `server_url`)
        - **snapcast**: Connects to Snapserver (requires `server_ip`)

        A unique MAC address is auto-generated if not provided.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePlayerRequest'
            examples:
              squeezelite:
                summary: Squeezelite player for LMS
                value:
                  name: Living Room
                  provider: squeezelite
                  device: hw:1,0
                  server_ip: 192.168.1.100
              sendspin:
                summary: Sendspin player for Music Assistant
                value:
                  name: Kitchen
                  provider: sendspin
                  device: "0"
                  server_url: ws://192.168.1.100:8095
              snapcast:
                summary: Snapcast player for Snapserver
                value:
                  name: Bedroom
                  provider: snapcast
                  device: default
                  server_ip: 192.168.1.100
      responses:
        '200':
          description: Player created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: Player 'Living Room' created successfully
        '400':
          description: Invalid request data (missing name, invalid characters, duplicate name)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missing_name:
                  summary: Name not provided
                  value:
                    success: false
                    error: Name is required
                invalid_chars:
                  summary: Invalid characters in name
                  value:
                    success: false
                    error: "Name contains invalid characters: '/'"
                duplicate:
                  summary: Player already exists
                  value:
                    success: false
                    error: Player 'Living Room' already exists

  /api/players/{playerName}:
    get:
      tags: [Players]
      summary: Get a single player
      description: |
        Retrieve the configuration for a specific player by name.

        Returns all configuration fields for the player including provider-specific settings.
      parameters:
        - $ref: '#/components/parameters/PlayerName'
      responses:
        '200':
          description: Player configuration retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Player'
              example:
                name: Living Room
                provider: squeezelite
                device: hw:1,0
                mac_address: dc:be:dd:e0:ce:40
                server_ip: 192.168.1.100
                enabled: true
                volume: 75
        '404':
          description: Player not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: Player not found
    put:
      tags: [Players]
      summary: Update a player
      description: |
        Update an existing player's configuration.

        You can change the player name, device, server settings, and other configuration.
        The player will be stopped if running and the new configuration will be saved.

        **Note:** The MAC address cannot be changed after creation.
      parameters:
        - $ref: '#/components/parameters/PlayerName'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePlayerRequest'
            example:
              name: Living Room Updated
              device: hw:2,0
              server_ip: 192.168.1.101
      responses:
        '200':
          description: Player updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          new_name:
                            type: string
                            description: New player name (included if name was changed)
              example:
                success: true
                message: Player updated successfully
                data:
                  new_name: Living Room Updated
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: Name contains invalid characters
    delete:
      tags: [Players]
      summary: Delete a player
      description: |
        Delete a player configuration permanently.

        If the player is currently running, it will be stopped first before deletion.
        This action cannot be undone.
      parameters:
        - $ref: '#/components/parameters/PlayerName'
      responses:
        '200':
          description: Player deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: Player 'Living Room' deleted successfully
        '404':
          description: Player not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: Player not found

  /api/players/{playerName}/start:
    post:
      tags: [Players]
      summary: Start a player
      description: |
        Start the audio player process for the specified player.

        The player will connect to its configured server (LMS, Music Assistant, or Snapserver)
        based on the provider type. The process runs in the background and can be monitored
        via the status endpoint or WebSocket updates.
      parameters:
        - $ref: '#/components/parameters/PlayerName'
      responses:
        '200':
          description: Player started successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: Player 'Living Room' started successfully

  /api/players/{playerName}/stop:
    post:
      tags: [Players]
      summary: Stop a player
      description: |
        Stop the audio player process for the specified player.

        The player process is terminated gracefully. The player configuration is preserved
        and the player can be started again later.
      parameters:
        - $ref: '#/components/parameters/PlayerName'
      responses:
        '200':
          description: Player stopped successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: Player 'Living Room' stopped successfully

  /api/players/{playerName}/status:
    get:
      tags: [Players]
      summary: Get player running status
      description: |
        Check if a player process is currently running.

        Returns a simple boolean indicating the running state. For real-time status updates
        across all players, use the WebSocket connection instead.
      parameters:
        - $ref: '#/components/parameters/PlayerName'
      responses:
        '200':
          description: Player status retrieved
          content:
            application/json:
              schema:
                type: object
                required:
                  - running
                properties:
                  running:
                    type: boolean
                    description: True if the player process is currently running
              example:
                running: true

  /api/players/{playerName}/volume:
    get:
      tags: [Volume]
      summary: Get player volume
      description: |
        Get the current volume level for a player. 
        
        For hardware devices, this reads the actual ALSA mixer volume.
        For virtual devices, this returns the stored volume setting.
      parameters:
        - $ref: '#/components/parameters/PlayerName'
      responses:
        '200':
          description: Volume retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  volume:
                    type: integer
                    minimum: 0
                    maximum: 100
                    description: Current volume percentage
              example:
                success: true
                volume: 75
        '404':
          description: Player not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      tags: [Volume]
      summary: Set player volume
      description: |
        Set the volume level for a player.
        
        For hardware devices, this uses ALSA mixer controls (`amixer`).
        The system automatically tries multiple mixer controls:
        - `Master` (most common)
        - `PCM` (common for USB devices) 
        - `Speaker` 
        - `Headphone`
        - `Digital`
        
        The response indicates which control was successfully used.
      parameters:
        - $ref: '#/components/parameters/PlayerName'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - volume
              properties:
                volume:
                  type: integer
                  minimum: 0
                  maximum: 100
                  description: Volume percentage (0-100)
                  example: 75
      responses:
        '200':
          description: Volume set successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: Volume set to 75% (PCM)
        '400':
          description: Invalid volume value
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error (e.g., mixer control failed)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/players/{playerName}/offset:
    put:
      tags: [Players]
      summary: Update player sync offset
      description: |
        Update the synchronization offset (delay) for a player.

        The offset is used to compensate for audio latency differences between players.
        Typical values are negative (-100 to -200ms) to delay playback slightly.

        **Note:** Changes require a player restart to take effect.
      parameters:
        - $ref: '#/components/parameters/PlayerName'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - delay_ms
              properties:
                delay_ms:
                  type: integer
                  minimum: -1000
                  maximum: 1000
                  description: Sync offset in milliseconds (-1000 to 1000)
                  example: -150
      responses:
        '200':
          description: Offset updated successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - delay_ms
                  - restart_required
                  - message
                properties:
                  success:
                    type: boolean
                  delay_ms:
                    type: integer
                    description: The new offset value
                  restart_required:
                    type: boolean
                    description: Whether the player needs to be restarted
                  message:
                    type: string
              example:
                success: true
                delay_ms: -150
                restart_required: true
                message: Offset updated to -150ms. Restart player to apply.
        '400':
          description: Invalid offset value
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: delay_ms must be between -1000 and 1000
        '404':
          description: Player not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: Player not found

  /api/providers:
    get:
      tags: [Providers]
      summary: List available providers
      description: |
        Get a list of available player provider backends.

        Each provider connects to a different audio server:
        - **squeezelite**: Logitech Media Server (LMS) using SlimProto
        - **sendspin**: Music Assistant using synchronized audio protocol
        - **snapcast**: Snapserver for synchronized multiroom audio

        The `available` field indicates whether the provider binary is installed
        and functional on this system.
      responses:
        '200':
          description: Providers retrieved successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - providers
                properties:
                  providers:
                    type: array
                    items:
                      $ref: '#/components/schemas/Provider'
              example:
                providers:
                  - type: squeezelite
                    name: Squeezelite
                    description: Logitech Media Server compatible player
                    available: true
                  - type: sendspin
                    name: Sendspin
                    description: Music Assistant native player
                    available: true
                  - type: snapcast
                    name: Snapcast
                    description: Synchronized multiroom audio client
                    available: false

  /api/devices:
    get:
      tags: [Devices]
      summary: Get ALSA audio devices
      description: |
        Retrieve a list of all available ALSA audio devices.

        This includes:
        - **Hardware devices**: Detected via `aplay -l` (e.g., `hw:1,0`, `hw:0,3`)
        - **Virtual devices**: `null` (silent), `pulse` (PulseAudio), `default`, `dmix`

        Use these device identifiers when creating Squeezelite or Snapcast players.
        For Sendspin players, use `/api/devices/portaudio` instead.
      responses:
        '200':
          description: Audio devices retrieved successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - devices
                properties:
                  devices:
                    type: array
                    items:
                      $ref: '#/components/schemas/AudioDevice'
              example:
                devices:
                  - id: hw:1,0
                    name: USB Audio DAC (hw:1,0)
                    card: "1"
                    device: "0"
                  - id: hw:0,3
                    name: HDA NVidia HDMI (hw:0,3)
                    card: "0"
                    device: "3"
                  - id: "null"
                    name: Null Audio Device (Silent)
                    card: null
                    device: "0"
                  - id: default
                    name: Default System Output
                    card: null
                    device: "0"

  /api/devices/portaudio:
    get:
      tags: [Devices]
      summary: Get PortAudio devices (for Sendspin)
      description: |
        Retrieve a list of PortAudio audio devices for use with Sendspin players.

        Sendspin uses PortAudio for audio output, which has different device indexing
        than ALSA. Use the device `index` value when creating Sendspin players.

        On Home Assistant OS (HAOS), if no PortAudio devices are found, this endpoint
        falls back to listing PulseAudio sinks.
      responses:
        '200':
          description: PortAudio devices retrieved successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - devices
                properties:
                  success:
                    type: boolean
                  devices:
                    type: array
                    items:
                      $ref: '#/components/schemas/PortAudioDevice'
                  raw_output:
                    type: string
                    description: Raw output from sendspin --list-audio-devices
                  note:
                    type: string
                    description: Usage instructions for the device index
                  fallback:
                    type: string
                    enum: [pulseaudio]
                    description: Present if PulseAudio fallback was used (HAOS only)
              examples:
                portaudio:
                  summary: PortAudio devices
                  value:
                    success: true
                    devices:
                      - index: "0"
                        name: "HDA NVidia: HDMI 0 (hw:1,3)"
                        raw: "[0] HDA NVidia: HDMI 0 (hw:1,3)"
                      - index: "1"
                        name: "USB Audio DAC (default)"
                        raw: "[1] USB Audio DAC (default)"
                    raw_output: "[0] HDA NVidia: HDMI 0 (hw:1,3)\n[1] USB Audio DAC (default)"
                    note: "Use device index (0, 1, 2) with --audio-device for sendspin"
                pulseaudio_fallback:
                  summary: PulseAudio fallback (HAOS)
                  value:
                    success: true
                    devices:
                      - index: "0"
                        name: "alsa_output.pci-0000_00_1f.3.analog-stereo"
                        raw: "0\talsa_output.pci-0000_00_1f.3.analog-stereo\tmodule-alsa-card.c"
                        type: "pulseaudio"
                    note: "Using PulseAudio sinks. Use sink name with sendspin on HAOS."
                    fallback: "pulseaudio"
        '500':
          description: Error listing devices (sendspin not found or timeout)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                  devices:
                    type: array
                    items: {}
              example:
                success: false
                message: sendspin binary not found
                devices: []

  /api/devices/test:
    post:
      tags: [Devices]
      summary: Test an audio device
      description: |
        Play a test tone on the specified audio device.

        This is useful for verifying that an audio device is working correctly
        before assigning it to a player. The test plays a brief tone through
        the device's speakers.

        **Note:** This feature may not be available in all versions.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - device
              properties:
                device:
                  type: string
                  description: Audio device identifier (e.g., hw:1,0)
                  example: hw:1,0
      responses:
        '200':
          description: Test tone played successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: Test tone played on hw:1,0
        '400':
          description: Device not specified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: Device is required
        '501':
          description: Test tone feature not available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: Test tone not available in this version

  /api/debug/audio:
    get:
      tags: [Debug]
      summary: Debug audio system
      description: |
        Comprehensive debugging information for audio device detection and mixer controls.
        
        This endpoint provides detailed information about:
        - Container mode (Windows vs Linux)
        - Detected audio devices
        - ALSA tool availability (`aplay`, `amixer`)
        - Available mixer controls for each hardware device
        - Raw command outputs for troubleshooting
      responses:
        '200':
          description: Debug information retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  container_mode:
                    type: boolean
                    description: Whether running in Windows compatibility mode
                  detected_devices:
                    type: array
                    items:
                      $ref: '#/components/schemas/AudioDevice'
                  aplay_available:
                    type: boolean
                    description: Whether aplay command is available
                  amixer_available:
                    type: boolean
                    description: Whether amixer command is available
                  aplay_output:
                    type: string
                    description: Raw output from `aplay -l` command
                  amixer_cards_output:
                    type: string
                    description: Raw output from `amixer` command
                  mixer_controls:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        type: string
                    description: Available mixer controls for each hardware device
              example:
                container_mode: false
                detected_devices:
                  - id: hw:1,0
                    name: Device (hw:1,0)
                    card: "1"
                    device: "0"
                aplay_available: true
                amixer_available: true
                mixer_controls:
                  "hw:1,0": ["PCM", "Speaker"]
                  "hw:0,3": ["Master", "PCM"]

  /api/state:
    get:
      tags: [State]
      summary: Get state information
      description: |
        Get information about player state persistence.

        **Note:** This endpoint is only available when running `app_enhanced.py`.
        The enhanced app provides automatic state persistence, saving player
        running states to `player_states.yaml` and restoring them on startup.

        This is useful for:
        - Checking if state persistence is active
        - Monitoring how many players are running vs configured
        - Verifying the state file exists
      responses:
        '200':
          description: State information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StateInfo'
              example:
                total_players: 4
                running_players: 2
                state_file_exists: true
                last_state_save: "2024-01-15T10:30:00"

  /api/state/save:
    post:
      tags: [State]
      summary: Manually save player states
      description: |
        Manually trigger a save of current player running states.

        **Note:** This endpoint is only available when running `app_enhanced.py`.

        The enhanced app automatically saves state periodically (every 30 seconds
        by default) and when players are started/stopped. This endpoint allows
        forcing an immediate save, which can be useful:
        - Before shutting down the container
        - After batch configuration changes
        - For backup purposes

        The state is saved to `player_states.yaml` in the config directory.
      responses:
        '200':
          description: State saved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: State saved successfully
        '500':
          description: Failed to save state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: Failed to save state - permission denied

components:
  parameters:
    PlayerName:
      name: playerName
      in: path
      required: true
      description: |
        Unique name of the player. This is used as the player identifier throughout the API.
        Names are case-sensitive and cannot contain special characters like `/`, `\`, or `:`.
      schema:
        type: string
        maxLength: 64
      example: Living Room

  schemas:
    Player:
      type: object
      description: |
        Complete player configuration. Fields vary by provider type.
      required:
        - name
        - device
      properties:
        name:
          type: string
          maxLength: 64
          description: Unique display name of the player
          example: Living Room
        provider:
          type: string
          enum: [squeezelite, sendspin, snapcast]
          description: |
            Player backend type:
            - `squeezelite`: Connects to Logitech Media Server (LMS)
            - `sendspin`: Connects to Music Assistant
            - `snapcast`: Connects to Snapserver
          default: squeezelite
          example: squeezelite
        device:
          type: string
          description: |
            Audio device identifier. Format depends on provider:
            - Squeezelite/Snapcast: ALSA device (e.g., `hw:1,0`, `default`, `null`)
            - Sendspin: PortAudio device index (e.g., `0`, `1`, `2`)
          example: hw:1,0
        mac_address:
          type: string
          pattern: '^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$'
          description: |
            Unique MAC address for the player. Auto-generated from player name hash
            if not provided. Used for identification with LMS/Snapserver.
          example: dc:be:dd:e0:ce:40
        server_ip:
          type: string
          format: ipv4
          description: |
            Server IP address for Squeezelite and Snapcast providers.
            Not used by Sendspin (uses server_url instead).
          example: 192.168.1.100
        server_url:
          type: string
          format: uri
          description: |
            WebSocket URL for Sendspin provider.
            Format: `ws://host:port` or `wss://host:port`
          example: ws://192.168.1.100:8095
        enabled:
          type: boolean
          description: Whether the player is enabled for automatic startup
          default: true
        volume:
          type: integer
          minimum: 0
          maximum: 100
          description: Current/default volume percentage (0-100)
          default: 75
        delay_ms:
          type: integer
          minimum: -1000
          maximum: 1000
          description: |
            Synchronization offset in milliseconds. Negative values delay playback
            to compensate for audio latency. Typical range: -200 to 0.
          default: 0
          example: -150

    AudioDevice:
      type: object
      description: ALSA audio device information for Squeezelite and Snapcast players.
      required:
        - id
        - name
        - card
        - device
      properties:
        id:
          type: string
          description: |
            ALSA device identifier to use with players.
            Format: `hw:X,Y` for hardware, or virtual device names.
          example: hw:1,0
        name:
          type: string
          description: Human-readable device name from ALSA
          example: USB Audio DAC (hw:1,0)
        card:
          type: string
          nullable: true
          description: ALSA card number (null for virtual devices)
          example: "1"
        device:
          type: string
          description: ALSA device number within the card
          example: "0"

    PortAudioDevice:
      type: object
      description: |
        PortAudio device information for Sendspin players.
        Use the `index` value as the device identifier when creating Sendspin players.
      required:
        - index
        - name
        - raw
      properties:
        index:
          type: string
          description: Device index number (use this as device ID for Sendspin)
          example: "0"
        name:
          type: string
          description: Device name from PortAudio
          example: "HDA NVidia: HDMI 0 (hw:1,3)"
        raw:
          type: string
          description: Raw output line from sendspin --list-audio-devices
          example: "[0] HDA NVidia: HDMI 0 (hw:1,3)"
        type:
          type: string
          enum: [pulseaudio]
          description: Present only for PulseAudio fallback devices (HAOS)
          example: pulseaudio

    Provider:
      type: object
      description: Information about an available player provider backend.
      required:
        - type
        - name
        - description
        - available
      properties:
        type:
          type: string
          enum: [squeezelite, sendspin, snapcast]
          description: Provider identifier used in API calls
          example: squeezelite
        name:
          type: string
          description: Human-readable provider name
          example: Squeezelite
        description:
          type: string
          description: Brief description of the provider
          example: Logitech Media Server compatible player
        available:
          type: boolean
          description: Whether the provider binary is installed and functional
          example: true

    CreatePlayerRequest:
      type: object
      description: |
        Request body for creating a new audio player.

        Required fields vary by provider:
        - **All providers**: `name`, `device`
        - **Squeezelite**: `server_ip` (optional, for auto-discovery leave empty)
        - **Sendspin**: `server_url` (WebSocket URL to Music Assistant)
        - **Snapcast**: `server_ip` (Snapserver address)
      required:
        - name
        - device
      properties:
        name:
          type: string
          maxLength: 64
          description: |
            Unique display name for the player. Cannot contain `/`, `\`, `:`, or other special characters.
          example: Living Room
        provider:
          type: string
          enum: [squeezelite, sendspin, snapcast]
          description: |
            Player backend type. Defaults to `squeezelite` if not specified.
          default: squeezelite
          example: squeezelite
        device:
          type: string
          description: |
            Audio device identifier:
            - For Squeezelite/Snapcast: Use ALSA device from `/api/devices` (e.g., `hw:1,0`)
            - For Sendspin: Use device index from `/api/devices/portaudio` (e.g., `0`)
          example: hw:1,0
        server_ip:
          type: string
          format: ipv4
          description: |
            Server IP address (Squeezelite and Snapcast only).
            For Squeezelite, leave empty to use auto-discovery.
          example: 192.168.1.100
        server_url:
          type: string
          format: uri
          description: |
            WebSocket URL for Music Assistant (Sendspin only).
            Format: `ws://host:port` or `wss://host:port`
          example: ws://192.168.1.100:8095
        mac_address:
          type: string
          pattern: '^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$'
          description: |
            Custom MAC address for player identification.
            If not provided, a unique MAC is auto-generated from the player name.
          example: aa:bb:cc:dd:ee:ff

    UpdatePlayerRequest:
      type: object
      description: |
        Request body for updating an existing player.

        All fields are optional except `name` and `device`. The MAC address cannot be changed.
      required:
        - name
        - device
      properties:
        name:
          type: string
          maxLength: 64
          description: |
            New name for the player. If different from the current name, the player will be renamed.
          example: Living Room Updated
        provider:
          type: string
          enum: [squeezelite, sendspin, snapcast]
          description: |
            Player backend type. Changing this will reconfigure the player for the new backend.
          example: squeezelite
        device:
          type: string
          description: Audio device identifier (see CreatePlayerRequest for format details)
          example: hw:1,0
        server_ip:
          type: string
          format: ipv4
          description: Server IP address (Squeezelite and Snapcast only)
          example: 192.168.1.100
        server_url:
          type: string
          format: uri
          description: WebSocket URL for Music Assistant (Sendspin only)
          example: ws://192.168.1.100:8095
        mac_address:
          type: string
          pattern: '^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$'
          description: |
            MAC address (read-only). This field is ignored if provided; MAC addresses cannot be changed after creation.
          readOnly: true
          example: aa:bb:cc:dd:ee:ff

    SuccessResponse:
      type: object
      description: Standard success response for API operations.
      required:
        - success
        - message
      properties:
        success:
          type: boolean
          description: Always `true` for success responses
          example: true
        message:
          type: string
          description: Human-readable success message describing what was done
          example: Player 'Living Room' created successfully
        data:
          type: object
          description: Optional additional data (varies by endpoint)
          additionalProperties: true

    ErrorResponse:
      type: object
      description: |
        Standard error response for API operations.

        **Note:** The error field name may be `error` or `message` depending on the endpoint.
        Check both fields when handling errors.
      required:
        - success
      properties:
        success:
          type: boolean
          description: Always `false` for error responses
          example: false
        error:
          type: string
          description: Human-readable error message (used by most endpoints)
          example: Player not found
        message:
          type: string
          description: Human-readable error message (used by some endpoints)
          example: Player not found

    StateInfo:
      type: object
      description: |
        Information about player state persistence.
        Only available when running app_enhanced.py.
      required:
        - total_players
        - running_players
        - state_file_exists
      properties:
        total_players:
          type: integer
          minimum: 0
          description: Total number of configured players
          example: 4
        running_players:
          type: integer
          minimum: 0
          description: Number of currently running players
          example: 2
        state_file_exists:
          type: boolean
          description: Whether the player_states.yaml file exists
          example: true
        last_state_save:
          type: string
          format: date-time
          nullable: true
          description: Timestamp of last state save (null if never saved)
          example: "2024-01-15T10:30:00"
